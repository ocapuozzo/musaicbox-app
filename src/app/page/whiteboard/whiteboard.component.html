<div class="main-page" id="white-board">

  @for (pcsDto of pcsDtoList; track pcsDto; let idx = $index) {
    <!--component has 3 data context : element DOM, object himself and pcsDto -->
    <app-pcs
      [ngClass]="{
      'example-box': true,
      'e-selected-marker': pcsDto.isSelected,
      'e-selected': pcsDto.isSelected && (pcsDto.indexFormDrawer > 0 || !pcsDto.uiMusaic.rounded),
      'e-selected-rounded': pcsDto.isSelected && pcsDto.indexFormDrawer == 0 && pcsDto.uiMusaic.rounded
      }"
      [attr.data-index-pcsdtos]=idx
      [style.height.px]="pcsDto.height"
      [style.width.px]="pcsDto.width"
      [style.top.px]="pcsDto.position.y"
      [style.left.px]="pcsDto.position.x"
      [cdkContextMenuTriggerFor]="menu"
      [cdkContextMenuTriggerData]="{
            name: pcsDto.pcs.getPcsStr(),
            index:idx,
            indexFormDrawer: pcsDto.indexFormDrawer
            }"
      [pcsDto]="pcsDto"
      (mousedown)="toggleSelected($event,idx)"
    >
    </app-pcs>
  }

  <ng-template #menu matMenuContent let-index="index" let-name="name" let-indexFormDrawer="indexFormDrawer">
    <div class="example-menu" cdkMenu>
      <span>Do with {{ name }}</span>
      <hr/>
      <button class="example-menu-item" cdkMenuItem (cdkMenuItemTriggered)="doPushToPcsPage(index)">Push to PCS page</button>
      <button class="example-menu-item" cdkMenuItem (cdkMenuItemTriggered)="doToggleSelected(index)">Select {{isSelected(index) ? 'OFF' : 'ON'}}</button>
      <button class="example-menu-item" cdkMenuItem (click)="doDelete(index)">Delete <span *ngIf="!isSolo(index)">&nbsp;({{numberSelectedComponents}})</span></button>
      <button class="example-menu-item" cdkMenuItem (click)="doDuplicate(index)">Duplicate <span *ngIf="!isSolo(index)">&nbsp;({{numberSelectedComponents}})</span></button>
      <button class="example-menu-item" cdkMenuItem (cdkMenuItemTriggered)="doZoom(1, index)">zoom+</button>
      <button class="example-menu-item" cdkMenuItem (cdkMenuItemTriggered)="doZoom(-1, index)">zoom-</button>
      <button class="example-menu-item" cdkMenuItem
              [disabled]="disabledIfNotMusaicFormDrawer(index)"
              (cdkMenuItemTriggered)="toggleRounded(index)">Set rounded {{ roundedOnOff(index) }}
      </button>
      <button class="example-menu-item" cdkMenuItem [cdkMenuTriggerFor]="create" [cdkMenuTriggerData]="{index: index}">
        Create <span>&#10148;</span>
      </button>
      <button class="example-menu-item" [disabled]="selectionIsEmpty()" cdkMenuItem [cdkMenuTriggerFor]="selection" [cdkMenuTriggerData]="{index: index}">
        Selection <span>&#10148;</span>
      </button>
      <button class="example-menu-item" cdkMenuItem [cdkMenuTriggerFor]="neighbors">
        Neighbors <span>&#10148;</span>
      </button>
      <hr/>
      <div cdkMenuGroup>
        @for (drawer of drawers; track drawer; let idx = $index) {
          <button
            cdkMenuItemRadio
            class="example-menu-item"
            [cdkMenuItemChecked]="idx === indexFormDrawer"
            (cdkMenuItemTriggered)="updateDrawer(drawer, index)">
            {{ drawer }}
          </button>
        }
      </div>
    </div>
  </ng-template>

  <ng-template #create let-index="index">
    <div class="example-menu" cdkMenu>
      <button class="example-menu-item" disabled cdkMenuItem>ModalPrimeForm</button>
      <hr/>
      <button class="example-menu-item" disabled cdkMenuItem>Pcs CyclicPF in orbit</button>
      <button class="example-menu-item" disabled cdkMenuItem>Simple Pcs in Cyclic orbit</button>
      <button class="example-menu-item" disabled cdkMenuItem>Other</button>
    </div>
  </ng-template>

  <ng-template #selection let-index="index">
    <div class="example-menu"   cdkMenu>
      <button class="example-menu-item" disabled cdkMenuItem >nop</button>
    </div>
  </ng-template>

  <ng-template #neighbors>
    <div class="example-menu" cdkMenu>
      <button class="example-menu-item" disabled cdkMenuItem>Up semitone</button>
      <button class="example-menu-item" disabled cdkMenuItem>Down semitone</button>
      <hr/>
      <button class="example-menu-item" disabled cdkMenuItem>Similarity IS</button>
      <button class="example-menu-item" disabled cdkMenuItem>Similarity IV</button>
      <button class="example-menu-item" disabled cdkMenuItem>Others</button>
    </div>
  </ng-template>

</div>
