<h2 class="text-center">88 Musaics</h2>

<div class="row" style="margin: auto; width: 80%">

  <div *ngFor="let musaic of listOrbits; index as index"
       class="box88" style="width: 60px;"
       [ngClass]="{'box88': true,
                   'box-selected': musaic.pcsDto.colorPitchOn !== 'black',
                   'box-not-selected' : musaic.pcsDto.colorPitchOn === 'black'
                   }"
  >
    <div class="box88-id text-muted p-0">
      {{ index + 1 }}
    </div>
    <div class="box88-body">
      <app-pcs
        [opaque]="musaicDrawGrid"
        [pcsDto]="musaic.pcsDto"
        [pcColorSet]="musaic.pcsDto.colorPitchOn"
        (click)="doPushToPcsPage(musaic.pcsDto.pcs)"
        [cdkContextMenuTriggerFor]="menu"
        [cdkContextMenuTriggerData]="{
            name: 'Musaic NÂ°' + (index+1),
            index:index,
            pcsDto:musaic.pcsDto
            }"
        style="cursor: pointer"
      >
      </app-pcs>
    </div>
    <div class="box88-footer">
      #{{ musaic.cardinal }}
    </div>
  </div>
</div>

<div class="text-center" style="margin-top: 20px">
  <h3> Your selection : @for (op of currentSelectedOps; track op) {
    {{ op }}
  } -> {{ nbMusaicsMatch ? nbMusaicsMatch : 'All' }} musaic{{ nbMusaicsMatch > 1 ? 's' : '' }} stabilized</h3>

  <h5>Select operations to highlight motif stabilizer</h5>
  <div class="button-row">
    <input type="checkbox" class="operation" id="m1" checked disabled/> <label for="m1">M1&nbsp;&nbsp;</label>
    @for (op of EightyEight.ORDERED_OPERATIONS_NAMES; track op; let index = $index) {
      @if (index > 0) {
        <input type="checkbox" class="operation" id="{{op}}" (click)="changeOp(op)" [checked]="isChecked(op)"/>
        <label for="{{op}}">{{ op }}&nbsp;&nbsp;</label>
      }
    }
  </div>
</div>
<div style="margin: auto; text-align: center">
  @for (groupedOrbitsByMotifStab of this.orbitsGroupedByMotifStab; track groupedOrbitsByMotifStab; let idx = $index) {
    <div style="display: inline-block; margin-top: 10px">
      <div [ngClass]="{
      'ddom-body':true,
      'ddom-selected': groupedOrbitsByMotifStab.selected,
      'ddom-active': groupedOrbitsByMotifStab.selected && groupedOrbitsByMotifStab.active}">
        <span (click)="doSelectOrbitsHavingSameMotifStabilizerThan(idx)">
          <app-ddom
            [w]="85"
            [pcs]="groupedOrbitsByMotifStab.pcs"
            [selected]="pcsMatchOperationStabilizersSelected(groupedOrbitsByMotifStab.pcs)"
          ></app-ddom>
        </span>
      </div>
      <div class="box88-footer">
        #{{ groupedOrbitsByMotifStab.cardinal }}
      </div>
    </div>
  }
</div>

<ng-template #menu matMenuContent let-index="index" let-name="name" let-pcsDto="pcsDto">
  <div class="contextual-menu" cdkMenu>
    <span>Do with {{ name }}</span>
    <hr/>
    <button class="contextual-menu-item" cdkMenuItem (cdkMenuItemTriggered)="doPushToPcsPage(pcsDto.pcs)">
      Push this to PCS page
    </button>
    <button class="contextual-menu-item" cdkMenuItem (cdkMenuItemTriggered)="doPushToWhiteboardPage(index)">
      Push this to Whiteboard page
    </button>
    <button class="contextual-menu-item" cdkMenuItem
            (cdkMenuItemTriggered)="doPushSelectionToWhiteboardPage(pcsDto.colorPitchOn)">
      Push selection ({{ cardinalWithThisColor(pcsDto.colorPitchOn) }}) to Whiteboard page
    </button>
  </div>
</ng-template>
